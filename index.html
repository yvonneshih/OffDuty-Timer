<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>下班倒计时与实时工资计算器</title>
    <style>
        body { font-family: 'Inter', 'Microsoft YaHei', Arial, sans-serif; background: #f7f8fa; color: #222; margin: 0; padding: 0; }
        .container { 
            width: 100%; 
            max-width: 500px; 
            margin: 20px auto; 
            background: #fff; 
            border-radius: 18px; 
            box-shadow: 0 4px 32px #0001; 
            padding: 32px 24px 28px 24px; 
            box-sizing: border-box; 
        }
        h2 { text-align: center; margin-bottom: 28px; font-weight: 600; font-size: 1.35rem; letter-spacing: 0.5px; }
        label { display: block; margin-top: 18px; font-weight: 500; font-size: 1rem; color: #444; letter-spacing: 0.1px; }
        input[type="time"], input[type="number"] {
            width: 100%;
            padding: 12px 14px;
            margin-top: 7px;
            border: none;
            border-radius: 7px;
            background: #f3f4f8;
            font-size: 1.1rem;
            color: #222;
            box-sizing: border-box;
            outline: none;
            transition: background 0.2s;
        }
        input[type="time"]:focus, input[type="number"]:focus {
            background: #e9eaf0;
        }
        .result {
            margin-top: 32px;
            background: #f8fafc;
            border-radius: 10px;
            padding: 24px 16px 20px 16px;
            font-size: 1.1rem;
            text-align: center;
            box-shadow: 0 1px 4px #0001;
        }
        .realtime-section, .fixed-section {
            margin-bottom: 24px;
        }
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #444;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e1e5e9;
            text-align: center;
        }
        .row {
            margin-bottom: 12px;
            text-align: center;
        }
        .money { color: #27ae60; font-weight: 600; font-size: 1.3rem; letter-spacing: 0.2px; }
        .countdown { color: #e67e22; font-weight: 600; font-size: 1.3rem; letter-spacing: 0.2px; }
        .row { margin-top: 15px; }
        .salary-rate { color: #3498db; font-weight: 600; font-size: 1.1rem; letter-spacing: 0.1px; }
        .overtime { color: #e74c3c; font-weight: 600; font-size: 1.1rem; }
        .off-duty-toggle {
            margin-top: 20px;
            text-align: center;
        }
        .toggle-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
        }
        .toggle-btn:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }
        .toggle-btn.clicked {
            background: #27ae60;
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
        }
        .toggle-btn.clicked:hover {
            background: #229954;
        }
        #langSelect {
            border: none;
            background: #f3f4f8;
            border-radius: 7px;
            padding: 8px 12px;
            font-size: 1rem;
            color: #222;
            outline: none;
            margin-left: 6px;
            transition: background 0.2s;
        }
        #langSelect:focus { background: #e9eaf0; }
        
        #timezoneSelect {
            border: none;
            background: #f3f4f8;
            border-radius: 7px;
            padding: 8px 12px;
            font-size: 1rem;
            color: #222;
            outline: none;
            margin-left: 6px;
            transition: background 0.2s;
        }
        #timezoneSelect:focus { background: #e9eaf0; }
        
        #currencySelect {
            border: none;
            background: #f3f4f8;
            border-radius: 7px;
            padding: 8px 12px;
            font-size: 1rem;
            color: #222;
            outline: none;
            margin-left: 6px;
            transition: background 0.2s;
        }
        #currencySelect:focus { background: #e9eaf0; }
        
        /* Mobile optimization */
        @media (max-width: 600px) {
            .container { 
                width: 95vw; 
                max-width: 95vw; 
                margin: 15px auto;
                padding: 24px 20px 20px 20px; 
            }
            h2 { font-size: 1.25rem; margin-bottom: 24px; }
            input[type="time"], input[type="number"] {
                padding: 14px 16px;
                font-size: 1.15rem;
            }
            .result {
                padding: 20px 14px 16px 14px;
                font-size: 1.05rem;
            }
            .realtime-section, .fixed-section {
                margin-bottom: 20px;
            }
            .section-title {
                font-size: 1rem;
                margin-bottom: 12px;
            }
            .money, .countdown { font-size: 1.25rem; }
        }
        
        /* Very small screens */
        @media (max-width: 400px) {
            .container { 
                width: 98vw; 
                max-width: 98vw; 
                margin: 10px auto;
                padding: 20px 16px 16px 16px; 
            }
            h2 { font-size: 1.15rem; margin-bottom: 20px; }
            label { font-size: 0.95rem; }
            input[type="time"], input[type="number"] {
                padding: 12px 14px;
                font-size: 1.1rem;
            }
            .result {
                padding: 18px 12px 14px 12px;
                font-size: 1rem;
            }
            .money, .countdown { font-size: 1.2rem; }
        }
        
        /* Landscape phones */
        @media (max-width: 800px) and (orientation: landscape) {
            .container { 
                width: 90vw; 
                max-width: 90vw; 
                margin: 10px auto;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div style="text-align:right;margin-bottom:10px;">
        <label for="langSelect" style="font-weight:normal;">语言/Language/Språk：</label>
        <select id="langSelect">
            <option value="zh">中文</option>
            <option value="en">English</option>
            <option value="no">Norsk</option>
        </select>
    </div>
    <div style="text-align:right;margin-bottom:10px;">
        <label for="timezoneSelect" style="font-weight:normal;" id="timezoneLabel">时区：</label>
        <select id="timezoneSelect">
            <option value="auto" data-zh="自动检测" data-en="Auto Detect" data-no="Auto-oppdagelse">自动检测</option>
            <option value="Asia/Shanghai" data-zh="中国" data-en="China" data-no="Kina">中国 (UTC+8)</option>
            <option value="America/New_York" data-zh="美国东部" data-en="US East" data-no="US Øst">美国东部 (UTC-5)</option>
            <option value="America/Los_Angeles" data-zh="美国西部" data-en="US West" data-no="US Vest">美国西部 (UTC-8)</option>
            <option value="Europe/London" data-zh="英国" data-en="UK" data-no="Storbritannia">英国 (UTC+0)</option>
            <option value="Europe/Paris" data-zh="欧洲" data-en="Europe" data-no="Europa">欧洲 (UTC+1)</option>
            <option value="Asia/Tokyo" data-zh="日本" data-en="Japan" data-no="Japan">日本 (UTC+9)</option>
            <option value="Asia/Seoul" data-zh="韩国" data-en="Korea" data-no="Korea">韩国 (UTC+9)</option>
            <option value="Australia/Sydney" data-zh="澳大利亚" data-en="Australia" data-no="Australia">澳大利亚 (UTC+10)</option>
            <option value="Europe/Oslo" data-zh="挪威" data-en="Norway" data-no="Norge">挪威 (UTC+1)</option>
            <option value="Europe/Stockholm" data-zh="瑞典" data-en="Sweden" data-no="Sverige">瑞典 (UTC+1)</option>
            <option value="Europe/Berlin" data-zh="德国" data-en="Germany" data-no="Tyskland">德国 (UTC+1)</option>
            <option value="Asia/Singapore" data-zh="新加坡" data-en="Singapore" data-no="Singapore">新加坡 (UTC+8)</option>
            <option value="Asia/Hong_Kong" data-zh="香港" data-en="Hong Kong" data-no="Hong Kong">香港 (UTC+8)</option>
            <option value="Asia/Taipei" data-zh="台湾" data-en="Taiwan" data-no="Taiwan">台湾 (UTC+8)</option>
        </select>
    </div>
    <h2 id="title">下班倒计时 & 实时工资计算器</h2>
    <label id="labelStart">上班时间（如 09:30）
        <input type="time" id="startTime" value="09:30">
    </label>
    <label id="labelEnd">下班时间（如 17:30）
        <input type="time" id="endTime" value="17:30">
    </label>
    <label id="labelSalary">月薪（元）
        <input type="number" id="monthlySalary" value="2690" min="0">
    </label>
    <label id="labelCurrency">货币
        <select id="currencySelect">
            <option value="CNY" data-zh="人民币" data-en="Chinese Yuan" data-no="Kinesisk Yuan">人民币 (CNY)</option>
            <option value="USD" data-zh="美元" data-en="US Dollar" data-no="US Dollar">美元 (USD)</option>
            <option value="EUR" data-zh="欧元" data-en="Euro" data-no="Euro">欧元 (EUR)</option>
            <option value="NOK" data-zh="挪威克朗" data-en="Norwegian Krone" data-no="Norsk Krone">挪威克朗 (NOK)</option>
            <option value="JPY" data-zh="日元" data-en="Japanese Yen" data-no="Japansk Yen">日元 (JPY)</option>
            <option value="KRW" data-zh="韩元" data-en="Korean Won" data-no="Koreansk Won">韩元 (KRW)</option>
            <option value="AUD" data-zh="澳元" data-en="Australian Dollar" data-no="Australsk Dollar">澳元 (AUD)</option>
            <option value="GBP" data-zh="英镑" data-en="British Pound" data-no="Britiske Pund">英镑 (GBP)</option>
        </select>
    </label>
    <div class="result">
        <div class="realtime-section">
            <div class="section-title">实时数据</div>
            <div class="row" id="rowCurrentTime">当前时间：<span class="countdown" id="currentTime">--:--:--</span></div>
            <div class="row" id="rowCountdown">距离下班还有：<span class="countdown" id="countdown">--:--:--</span></div>
            <div class="row" id="rowToday">今日已赚：<span class="money" id="todayEarned">¥0.00</span></div>
            <div class="row" id="rowMonth">本月已赚：<span class="money" id="monthEarned">¥0.00</span></div>
            <div class="row" id="rowOrigHourly">原定时薪：<span class="salary-rate" id="origHourlySalary">¥0.00</span></div>
            <div class="row" id="rowRealHourly">实时时薪：<span class="salary-rate" id="realHourlySalary">¥0.00</span></div>
            <div class="row" id="rowOrigMinute">原定分钟薪：<span class="salary-rate" id="origMinuteSalary">¥0.00</span></div>
            <div class="row" id="rowRealMinute">实时分钟薪：<span class="salary-rate" id="realMinuteSalary">¥0.00</span></div>
            <div class="row" id="rowOvertime" style="display:none;">加班损失：<span class="overtime" id="overtimeLoss">¥0.00</span></div>
        </div>
        <div class="fixed-section">
            <div class="section-title">基础信息</div>
            <div class="row" id="rowMonthInfo">月份：<span class="countdown" id="monthInfo">--</span></div>
            <div class="row" id="rowWorkdays">工作日：<span class="countdown" id="workdays">--</span></div>
            <div class="row" id="rowDaily">日薪：<span class="money" id="dailySalary">¥0.00</span></div>
        </div>
    </div>
    <div class="off-duty-toggle">
        <button class="toggle-btn" id="offDutyBtn">准时下班</button>
        <button class="toggle-btn" id="stillWorkingBtn">我还在加班</button>
    </div>
</div>
<script>
function pad(n) { return n < 10 ? '0' + n : n; }

function getWorkSeconds(start, end) {
    // 计算一天的工作总秒数
    let [sh, sm] = start.split(":").map(Number);
    let [eh, em] = end.split(":").map(Number);
    let startSec = sh * 3600 + sm * 60;
    let endSec = eh * 3600 + em * 60;
    if (endSec <= startSec) endSec += 24 * 3600; // 跨天
    return endSec - startSec;
}

// 获取指定时区的当前时间
function getCurrentTimeInTimezone(timezone) {
    if (timezone === 'auto') {
        return new Date();
    }
    
    try {
        const now = new Date();
        const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
        const targetTime = new Date(utc + (getTimezoneOffset(timezone) * 60000));
        return targetTime;
    } catch (e) {
        return new Date(); // 如果时区无效，返回本地时间
    }
}

// 获取时区偏移量（分钟）
function getTimezoneOffset(timezone) {
    const timezoneOffsets = {
        'Asia/Shanghai': 480,      // UTC+8
        'America/New_York': -300,  // UTC-5
        'America/Los_Angeles': -480, // UTC-8
        'Europe/London': 0,        // UTC+0
        'Europe/Paris': 60,        // UTC+1
        'Asia/Tokyo': 540,         // UTC+9
        'Asia/Seoul': 540,         // UTC+9
        'Australia/Sydney': 600,   // UTC+10
        'Europe/Oslo': 60,         // UTC+1
        'Europe/Stockholm': 60,    // UTC+1
        'Europe/Berlin': 60,       // UTC+1
        'Asia/Singapore': 480,     // UTC+8
        'Asia/Hong_Kong': 480,     // UTC+8
        'Asia/Taipei': 480         // UTC+8
    };
    return timezoneOffsets[timezone] || 0;
}

function getTodayWorkProgress(start, end) {
    const timezone = document.getElementById('timezoneSelect').value;
    let now = getCurrentTimeInTimezone(timezone);
    let [sh, sm] = start.split(":").map(Number);
    let [eh, em] = end.split(":").map(Number);
    let startSec = sh * 3600 + sm * 60;
    let endSec = eh * 3600 + em * 60;
    let nowSec = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
    if (endSec <= startSec) endSec += 24 * 3600; // 跨天
    let workSec = endSec - startSec;
    let passed = nowSec - startSec;
    if (nowSec < startSec) passed = 0;
    if (nowSec > endSec) passed = workSec;
    if (passed < 0) passed = 0;
    if (passed > workSec) passed = workSec;
    return { passed, workSec };
}

function getMonthWorkDays() {
    // 计算本月工作日天数（周一到周五）
    const timezone = document.getElementById('timezoneSelect').value;
    let now = getCurrentTimeInTimezone(timezone);
    let year = now.getFullYear();
    let month = now.getMonth();
    let days = new Date(year, month + 1, 0).getDate();
    let workdays = 0;
    for (let d = 1; d <= days; d++) {
        let day = new Date(year, month, d).getDay();
        if (day !== 0 && day !== 6) workdays++;
    }
    return workdays;
}

function getMonthWorkSeconds(start, end) {
    return getWorkSeconds(start, end) * getMonthWorkDays();
}

const i18n = {
    zh: {
        title: '下班倒计时 & 实时工资计算器',
        start: '上班时间（如 09:30）',
        end: '下班时间（如 17:30）',
        salary: '月薪（元）',
        currency: '货币',
        currentTime: '当前时间：',
        countdown: '距离下班还有：',
        monthInfo: '月份：',
        workdays: '工作日：',
        daily: '日薪：',
        today: '今日已赚：',
        month: '本月已赚：',
        origHourly: '原定时薪：',
        realHourly: '实时时薪：',
        origMinute: '原定分钟薪：',
        realMinute: '实时分钟薪：',
        overtime: '加班损失：',
        offDutyBtn: '准时下班',
        stillWorkingBtn: '我还在加班',
        currencySymbol: '¥',
        lang: '语言',
        timezone: '时区',
        realtimeTitle: '实时数据',
        fixedTitle: '基础信息'
    },
    en: {
        title: 'Off Duty Countdown & Real-time Salary Calculator',
        start: 'Start Time (e.g. 09:30)',
        end: 'Off Duty Time (e.g. 17:30)',
        salary: 'Monthly Salary',
        currency: 'Currency',
        currentTime: 'Current time:',
        countdown: 'Time left until off duty:',
        monthInfo: 'Month:',
        workdays: 'Workdays:',
        daily: 'Daily salary:',
        today: 'Earned today:',
        month: 'Earned this month:',
        origHourly: 'Original hourly:',
        realHourly: 'Real-time hourly:',
        origMinute: 'Original per minute:',
        realMinute: 'Real-time per minute:',
        overtime: 'Overtime loss:',
        offDutyBtn: 'Off Duty On Time',
        stillWorkingBtn: 'I\'m Still Working',
        currencySymbol: '¥',
        lang: 'Language',
        timezone: 'Timezone',
        realtimeTitle: 'Real-time Data',
        fixedTitle: 'Basic Information'
    },
    no: {
        title: 'Nedtelling til arbeidsdag slutt & Lønnskalkulator',
        start: 'Arbeidsstart (f.eks. 09:30)',
        end: 'Arbeidsslutt (f.eks. 17:30)',
        salary: 'Månedslønn',
        currency: 'Valuta',
        currentTime: 'Nåværende tid:',
        countdown: 'Tid igjen til arbeidsdag slutt:',
        monthInfo: 'Måned:',
        workdays: 'Arbeidsdager:',
        daily: 'Daglig lønn:',
        today: 'Tjent i dag:',
        month: 'Tjent denne måneden:',
        origHourly: 'Opprinnelig timelønn:',
        realHourly: 'Sanntids timelønn:',
        origMinute: 'Opprinnelig minuttlønn:',
        realMinute: 'Sanntids minuttlønn:',
        overtime: 'Overtidstap:',
        offDutyBtn: 'Av jobb til tiden',
        stillWorkingBtn: 'Jeg jobber fortsatt',
        currencySymbol: '¥',
        lang: 'Språk',
        timezone: 'Tidssone',
        realtimeTitle: 'Sanntidsdata',
        fixedTitle: 'Grunnleggende informasjon'
    }
};

function setLang(lang) {
    document.getElementById('title').textContent = i18n[lang].title;
    document.getElementById('labelStart').childNodes[0].textContent = i18n[lang].start;
    document.getElementById('labelEnd').childNodes[0].textContent = i18n[lang].end;
    document.getElementById('labelSalary').childNodes[0].textContent = i18n[lang].salary;
    document.getElementById('labelCurrency').childNodes[0].textContent = i18n[lang].currency;
    document.getElementById('timezoneLabel').textContent = i18n[lang].timezone + '：';
    document.getElementById('rowMonthInfo').childNodes[0].textContent = i18n[lang].monthInfo;
    document.getElementById('rowWorkdays').childNodes[0].textContent = i18n[lang].workdays;
    document.getElementById('rowCurrentTime').childNodes[0].textContent = i18n[lang].currentTime;
    document.getElementById('rowCountdown').childNodes[0].textContent = i18n[lang].countdown;
    document.getElementById('rowDaily').childNodes[0].textContent = i18n[lang].daily;
    document.getElementById('rowToday').childNodes[0].textContent = i18n[lang].today;
    document.getElementById('rowMonth').childNodes[0].textContent = i18n[lang].month;
    document.getElementById('rowOrigHourly').childNodes[0].textContent = i18n[lang].origHourly;
    document.getElementById('rowRealHourly').childNodes[0].textContent = i18n[lang].realHourly;
    document.getElementById('rowOrigMinute').childNodes[0].textContent = i18n[lang].origMinute;
    document.getElementById('rowRealMinute').childNodes[0].textContent = i18n[lang].realMinute;
    document.getElementById('rowOvertime').childNodes[0].textContent = i18n[lang].overtime;
    
    // 更新区域标题
    document.querySelectorAll('.section-title')[0].textContent = i18n[lang].realtimeTitle;
    document.querySelectorAll('.section-title')[1].textContent = i18n[lang].fixedTitle;
    
    // 更新按钮文本
    document.getElementById('offDutyBtn').textContent = i18n[lang].offDutyBtn;
    document.getElementById('stillWorkingBtn').textContent = i18n[lang].stillWorkingBtn;
    
    // 更新时区选项的文本
    const timezoneSelect = document.getElementById('timezoneSelect');
    const selectedValue = timezoneSelect.value;
    for (let option of timezoneSelect.options) {
        const langKey = lang === 'zh' ? 'zh' : lang === 'en' ? 'en' : 'no';
        const translatedText = option.getAttribute(`data-${langKey}`);
        if (translatedText) {
            const utcPart = option.textContent.match(/\(UTC[+-]\d+\)/);
            option.textContent = translatedText + (utcPart ? ' ' + utcPart[0] : '');
        }
    }
    timezoneSelect.value = selectedValue; // 保持选中状态
    
    // 更新货币选项的文本
    const currencySelect = document.getElementById('currencySelect');
    const selectedCurrency = currencySelect.value;
    for (let option of currencySelect.options) {
        const langKey = lang === 'zh' ? 'zh' : lang === 'en' ? 'en' : 'no';
        const translatedText = option.getAttribute(`data-${langKey}`);
        if (translatedText) {
            const codePart = option.textContent.match(/\([A-Z]{3}\)/);
            option.textContent = translatedText + (codePart ? ' ' + codePart[0] : '');
        }
    }
    currencySelect.value = selectedCurrency; // 保持选中状态
    
    updateOffDutyButtons();
}

let currentLang = 'zh';
let isOffDuty = false;

// 货币配置
const currencyConfig = {
    CNY: { symbol: '¥', rate: 1.0 },
    USD: { symbol: '$', rate: 0.14 },
    EUR: { symbol: '€', rate: 0.13 },
    NOK: { symbol: 'kr', rate: 1.5 },
    JPY: { symbol: '¥', rate: 20.5 },
    KRW: { symbol: '₩', rate: 185.0 },
    AUD: { symbol: 'A$', rate: 0.21 },
    GBP: { symbol: '£', rate: 0.11 }
};

document.getElementById('langSelect').addEventListener('change', function() {
    currentLang = this.value;
    setLang(currentLang);
    update();
});

document.getElementById('timezoneSelect').addEventListener('change', function() {
    update();
});

document.getElementById('currencySelect').addEventListener('change', function() {
    update();
});

// 按钮事件
const offDutyBtn = document.getElementById('offDutyBtn');
const stillWorkingBtn = document.getElementById('stillWorkingBtn');

offDutyBtn.addEventListener('click', function() {
    isOffDuty = true;
    updateOffDutyButtons();
    update();
});

stillWorkingBtn.addEventListener('click', function() {
    isOffDuty = false;
    updateOffDutyButtons();
    update();
});

function updateOffDutyButtons() {
    if (isOffDuty) {
        offDutyBtn.classList.add('clicked');
        stillWorkingBtn.classList.remove('clicked');
    } else {
        offDutyBtn.classList.remove('clicked');
        stillWorkingBtn.classList.add('clicked');
    }
}

function isAfterOffDutyTime(endTime) {
    const timezone = document.getElementById('timezoneSelect').value;
    let now = getCurrentTimeInTimezone(timezone);
    let [eh, em] = endTime.split(":").map(Number);
    let todayEndTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), eh, em, 0);
    return now > todayEndTime;
}

function update() {
    let start = document.getElementById('startTime').value;
    let end = document.getElementById('endTime').value;
    let salary = parseFloat(document.getElementById('monthlySalary').value) || 0;
    let selectedCurrency = document.getElementById('currencySelect').value;
    let currencyInfo = currencyConfig[selectedCurrency];
    
    if (!start || !end || salary <= 0) {
        document.getElementById('currentTime').textContent = now.toLocaleTimeString('zh-CN', { hour12: false });
        document.getElementById('countdown').textContent = '--:--:--';
        document.getElementById('monthInfo').textContent = now.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long' });
        document.getElementById('workdays').textContent = getMonthWorkDays();
        document.getElementById('dailySalary').textContent = currencyInfo.symbol + '0.00';
        document.getElementById('todayEarned').textContent = currencyInfo.symbol + '0.00';
        document.getElementById('monthEarned').textContent = currencyInfo.symbol + '0.00';
        document.getElementById('origHourlySalary').textContent = currencyInfo.symbol + '0.00';
        document.getElementById('realHourlySalary').textContent = currencyInfo.symbol + '0.00';
        document.getElementById('origMinuteSalary').textContent = currencyInfo.symbol + '0.00';
        document.getElementById('realMinuteSalary').textContent = currencyInfo.symbol + '0.00';
        document.getElementById('overtimeLoss').textContent = currencyInfo.symbol + '0.00';
        document.getElementById('rowOvertime').style.display = 'none';
        return;
    }
    
    const timezone = document.getElementById('timezoneSelect').value;
    let now = getCurrentTimeInTimezone(timezone);
    let [eh, em] = end.split(":").map(Number);
    let endTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), eh, em, 0);
    let isAfterOffDuty = now > endTime;
    
    // 计算基础薪资
    let dayWorkSeconds = getWorkSeconds(start, end);
    let dayEarn = salary / getMonthWorkDays();
    let baseHourlyRate = dayEarn / (dayWorkSeconds / 3600);
    let baseMinuteRate = baseHourlyRate / 60;
    
    // 货币转换
    let convertedDayEarn = dayEarn * currencyInfo.rate;
    let convertedHourlyRate = baseHourlyRate * currencyInfo.rate;
    let convertedMinuteRate = baseMinuteRate * currencyInfo.rate;
    
    // 逻辑处理
    // 固定工资（原定时薪/分钟薪始终为正常值）
    let origHourlyRate = convertedHourlyRate;
    let origMinuteRate = convertedMinuteRate;
    let displayDaily = convertedDayEarn;
    let displayHourlyRate = origHourlyRate;
    let displayMinuteRate = origMinuteRate;
    
    if (isOffDuty) {
        // 准时下班 → 实时时薪/分钟薪 = 原定值
        displayHourlyRate = origHourlyRate;
        displayMinuteRate = origMinuteRate;
        document.getElementById('rowOvertime').style.display = 'none';
    } else {
        if (!isAfterOffDuty) {
            // 上班时间内 → 实时时薪/分钟薪 = 原定值（不打折）
            displayHourlyRate = origHourlyRate;
            displayMinuteRate = origMinuteRate;
            document.getElementById('rowOvertime').style.display = 'none';
        } else {
            // 下班时间后 → 实时时薪/分钟薪递减
            let overtimeMinutes = Math.floor((now - endTime) / 60000);
            let overtimeSeconds = Math.floor((now - endTime) / 1000);
            let reductionFactor = Math.max(0.1, 1 - (overtimeSeconds * 0.000167)); // 每秒减少0.0167%，每分钟减少1%
            displayHourlyRate = origHourlyRate * reductionFactor;
            displayMinuteRate = origMinuteRate * reductionFactor;
            let overtimeLoss = overtimeSeconds * (origMinuteRate / 60); // 基于秒计算，每秒损失原定分钟薪/60
            document.getElementById('overtimeLoss').textContent = currencyInfo.symbol + overtimeLoss.toFixed(2);
            document.getElementById('rowOvertime').style.display = 'block';
        }
    }
    
    document.getElementById('dailySalary').textContent = currencyInfo.symbol + convertedDayEarn.toFixed(2);
    document.getElementById('origHourlySalary').textContent = currencyInfo.symbol + origHourlyRate.toFixed(2);
    document.getElementById('realHourlySalary').textContent = currencyInfo.symbol + displayHourlyRate.toFixed(2);
    document.getElementById('origMinuteSalary').textContent = currencyInfo.symbol + origMinuteRate.toFixed(2);
    document.getElementById('realMinuteSalary').textContent = currencyInfo.symbol + displayMinuteRate.toFixed(2);
    
    // 下班倒计时
    if (isOffDuty) {
        // 点击了下班按钮 → 倒计时为0
        document.getElementById('countdown').textContent = '00:00:00';
    } else {
        // 没点击下班按钮 → 正常倒计时
        if (endTime < now) endTime.setDate(endTime.getDate() + 1); // 跨天
        let diff = Math.max(0, Math.floor((endTime - now) / 1000));
        let h = Math.floor(diff / 3600), m = Math.floor((diff % 3600) / 60), s = diff % 60;
        document.getElementById('countdown').textContent = pad(h) + ':' + pad(m) + ':' + pad(s);
    }
    
    // 今日已赚
    let { passed, workSec } = getTodayWorkProgress(start, end);
    let todayEarned;
    if (isOffDuty) {
        // 点击了下班按钮 → 立即获得全天工资
        todayEarned = convertedDayEarn;
    } else {
        // 没点击下班按钮 → 按实际工作时间计算
        todayEarned = convertedDayEarn * (passed / workSec);
        if (workSec === 0) todayEarned = 0;
    }
    
    document.getElementById('todayEarned').textContent = currencyInfo.symbol + todayEarned.toFixed(2);
    
    // 本月已赚
    let nowDay = now.getDate();
    let nowMonth = now.getMonth();
    let nowYear = now.getFullYear();
    let earned = 0;
    for (let d = 1; d <= nowDay; d++) {
        let day = new Date(nowYear, nowMonth, d).getDay();
        if (day !== 0 && day !== 6) {
            if (d === nowDay) {
                earned += todayEarned;
            } else {
                earned += convertedDayEarn;
            }
        }
    }
    document.getElementById('monthEarned').textContent = currencyInfo.symbol + earned.toFixed(2);
    
    // 显示月份和工作日信息
    document.getElementById('monthInfo').textContent = now.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long' });
    document.getElementById('workdays').textContent = getMonthWorkDays();
    
    // 显示当前时间
    document.getElementById('currentTime').textContent = now.toLocaleTimeString('zh-CN', { hour12: false });
}

['startTime', 'endTime', 'monthlySalary'].forEach(id => {
    document.getElementById(id).addEventListener('input', update);
});
setInterval(update, 1000);
update();
setLang(currentLang);
// 初始化按钮状态
updateOffDutyButtons();
</script>
</body>
</html>
